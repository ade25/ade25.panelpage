/*!
* panelpage by Ade25
* Copyright Ade25
* Licensed under MIT.
*
* Designed and built by ade25
*/
if("undefined"==typeof jQuery)throw new Error("We require jQuery");!function(a){var b,c=a();a.fn.sortable=function(d){var e=String(d);return d=a.extend({connectWith:!1},d),this.each(function(){if(/^enable|disable|destroy$/.test(e)){var f=a(this).children(a(this).data("items")).attr("draggable","enable"==e);return void("destroy"==e&&f.add(this).removeData("connectWith items").off("dragstart.h5s dragend.h5s selectstart.h5s dragover.h5s dragenter.h5s drop.h5s"))}var g,h,f=a(this).children(d.items),i=a("<"+(/^ul|ol$/i.test(this.tagName)?"li":"div")+' class="sortable-placeholder">');f.find(d.handle).mousedown(function(){g=!0}).mouseup(function(){g=!1}),a(this).data("items",d.items),c=c.add(i),d.connectWith&&a(d.connectWith).add(this).data("connectWith",d.connectWith),f.attr("draggable","true").on("dragstart.h5s",function(c){if(d.handle&&!g)return!1;g=!1;var e=c.originalEvent.dataTransfer;e.effectAllowed="move",e.setData("Text","dummy"),h=(b=a(this)).addClass("sortable-dragging").index()}).on("dragend.h5s",function(){b&&(b.removeClass("sortable-dragging").show(),c.detach(),h!=b.index()&&b.parent().trigger("sortupdate",{item:b}),b=null)}).not("a[href], img").on("selectstart.h5s",function(){return this.dragDrop&&this.dragDrop(),!1}).end().add([this,i]).on("dragover.h5s dragenter.h5s drop.h5s",function(e){return f.is(b)||d.connectWith===a(b).parent().data("connectWith")?"drop"==e.type?(e.stopPropagation(),c.filter(":visible").after(b),b.trigger("dragend.h5s"),!1):(e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="move",f.is(this)?(d.forcePlaceholderSize&&i.height(b.outerHeight()),b.hide(),a(this)[i.index()<a(this).index()?"after":"before"](i),c.not(i).detach()):c.is(this)||a(this).children(d.items).length||(c.detach(),a(this).append(i)),!1):!0})})}}(jQuery),function(a){"function"==typeof define&&define.amd?define(["jquery","gridlist"],a):a(jQuery,GridList)}(function(a,b){var c=function(b,c){this.options=a.extend({},this.defaults,c),this.$element=a(b),this._init(),this._bindEvents()};c.prototype={defaults:{rows:5,widthHeightRatio:1,dragAndDrop:!0},destroy:function(){this._unbindEvents()},resize:function(a){a&&(this.options.rows=a),this._createGridSnapshot(),this.gridList.resizeGrid(this.options.rows),this._updateGridSnapshot(),this.reflow()},resizeItem:function(a,b){this._createGridSnapshot(),this.gridList.resizeItem(this._getItemByElement(a),b),this._updateGridSnapshot(),this.render()},reflow:function(){this._calculateCellSize(),this.render()},render:function(){this._applySizeToItems(),this._applyPositionToItems()},_bindMethod:function(a){var b=this;return function(){return a.apply(b,arguments)}},_init:function(){this.$items=this.$element.children("li[data-w]"),this.items=this._generateItemsFromDOM(),this.$positionHighlight=this.$element.find(".position-highlight").hide(),this._initGridList(),this.reflow(),this.options.dragAndDrop&&this.$items.draggable({zIndex:this.items.length,scroll:!1})},_initGridList:function(){this.gridList=new b(this.items,{rows:this.options.rows})},_bindEvents:function(){this._onStart=this._bindMethod(this._onStart),this._onDrag=this._bindMethod(this._onDrag),this._onStop=this._bindMethod(this._onStop),this.$items.on("dragstart",this._onStart),this.$items.on("drag",this._onDrag),this.$items.on("dragstop",this._onStop)},_unbindEvents:function(){this.$items.off("dragstart",this._onStart),this.$items.off("drag",this._onDrag),this.$items.off("dragstop",this._onStop)},_onStart:function(){this._createGridSnapshot(),this._maxGridCols=this.gridList.grid.length},_onDrag:function(a,c){var d=this._getItemByElement(c.helper),e=this._snapItemPositionToGrid(d);this._dragPositionChanged(e)&&(this._previousDragPosition=e,b.cloneItems(this._items,this.items),this.gridList.generateGrid(),d=this._getItemByElement(c.helper),this.gridList.moveItemToPosition(d,e),this._applyPositionToItems(),this._highlightPositionForItem(d))},_onStop:function(b,c){this._updateGridSnapshot(),this._previousDragPosition=null,a(c.helper).removeClass("ui-draggable-dragging"),this._applyPositionToItems(),this._removePositionHighlight()},_generateItemsFromDOM:function(){var b=[];return this.$items.each(function(c,d){b.push({$element:a(d),x:Number(a(d).attr("data-x")),y:Number(a(d).attr("data-y")),w:Number(a(d).attr("data-w")),h:Number(a(d).attr("data-h")),id:Number(a(d).attr("data-id"))})}),b},_getItemByElement:function(a){for(var b=0;b<this.items.length;b++)if(this.items[b].$element.is(a))return this.items[b]},_calculateCellSize:function(){this._cellHeight=Math.floor(this.$element.height()/this.options.rows),this._cellWidth=this._cellHeight*this.options.widthHeightRatio,this.options.heightToFontSizeRatio&&(this._fontSize=this._cellHeight*this.options.heightToFontSizeRatio)},_getItemWidth:function(a){return a.w*this._cellWidth},_getItemHeight:function(a){return a.h*this._cellHeight},_applySizeToItems:function(){for(var a=0;a<this.items.length;a++)this.items[a].$element.css({width:this._getItemWidth(this.items[a]),height:this._getItemHeight(this.items[a])});this.options.heightToFontSizeRatio&&this.$items.css("font-size",this._fontSize)},_applyPositionToItems:function(){for(var a=0;a<this.items.length;a++)this.items[a].move||this.items[a].$element.css({left:this.items[a].x*this._cellWidth,top:this.items[a].y*this._cellHeight});this.$element.width((this.gridList.grid.length+1)*this._cellWidth)},_dragPositionChanged:function(a){return this._previousDragPosition?a[0]!=this._previousDragPosition[0]||a[1]!=this._previousDragPosition[1]:!0},_snapItemPositionToGrid:function(a){var b,c,d=a.$element.position();return d[0]-=this.$element.position().left,c=Math.round(d.left/this._cellWidth),b=Math.round(d.top/this._cellHeight),c=Math.max(c,0),b=Math.max(b,0),c=Math.min(c,this._maxGridCols),b=Math.min(b,this.options.rows-a.h),[c,b]},_highlightPositionForItem:function(a){this.$positionHighlight.css({width:this._getItemWidth(a),height:this._getItemHeight(a),left:a.x*this._cellWidth,top:a.y*this._cellHeight}).show(),this.options.heightToFontSizeRatio&&this.$positionHighlight.css("font-size",this._fontSize)},_removePositionHighlight:function(){this.$positionHighlight.hide()},_createGridSnapshot:function(){this._items=b.cloneItems(this.items)},_updateGridSnapshot:function(){this._triggerOnChange(),b.cloneItems(this.items,this._items)},_triggerOnChange:function(){"function"==typeof this.options.onChange&&this.options.onChange.call(this,this.gridList.getChangedItems(this._items,"$element"))}},a.fn.gridList=function(b){if(!window.GridList)throw new Error("GridList lib required");var d,e,f;return"string"==typeof b&&(e=b,f=Array.prototype.slice.call(arguments,1)),this.each(function(){d=a(this).data("_gridList"),d&&!e&&(d.destroy(),d=null),d||(d=new c(this,b),a(this).data("_gridList",d)),e&&d[e].apply(d,f)}),this}}),function(a){a(document).ready(function(){a('div[data-appui="editable"]').on({mouseenter:function(){a(this).find("contentpanel-editbar").removeClass("fadeOutUp").addClass("fadeInLeft").show()},mouseleave:function(){a(this).find("contentpanel-editbar").removeClass("fadeInLeft").addClass("fadeOutUp")}});var b=a(".ppe-section-sortable").sortable({items:".ppe-block-sortable",handle:".ppe-dragindicator"});b.length&&b.on("sortupdate",function(){var c=b.data("appui-ajax-uri"),d=a("#ppe-form-rearrange").serializeArray();a.ajax({url:c,data:d,context:document.body,success:function(b){if(b.success===!0){var c=b.message,d='<p class="text-warning">'+c+"</p>";a("#ppe-statusinfo").append(d).removeClass("hide").slideDown("slow")}else console.log("Form could not be submitted. Bummer.")}})})})}(jQuery);