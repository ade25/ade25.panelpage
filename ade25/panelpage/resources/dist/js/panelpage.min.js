/*!
* panelpage by Ade25
* Copyright Ade25
* Licensed under MIT.
*
* Designed and built by ade25
*/
if("undefined"==typeof jQuery)throw new Error("We require jQuery");!function(a){var b,c=a();a.fn.sortable=function(d){var e=String(d);return d=a.extend({connectWith:!1},d),this.each(function(){if(/^enable|disable|destroy$/.test(e)){var f=a(this).children(a(this).data("items")).attr("draggable","enable"==e);return void("destroy"==e&&f.add(this).removeData("connectWith items").off("dragstart.h5s dragend.h5s selectstart.h5s dragover.h5s dragenter.h5s drop.h5s"))}var g,h,f=a(this).children(d.items),i=a("<"+(/^ul|ol$/i.test(this.tagName)?"li":"div")+' class="sortable-placeholder">');f.find(d.handle).mousedown(function(){g=!0}).mouseup(function(){g=!1}),a(this).data("items",d.items),c=c.add(i),d.connectWith&&a(d.connectWith).add(this).data("connectWith",d.connectWith),f.attr("draggable","true").on("dragstart.h5s",function(c){if(d.handle&&!g)return!1;g=!1;var e=c.originalEvent.dataTransfer;e.effectAllowed="move",e.setData("Text","dummy"),h=(b=a(this)).addClass("sortable-dragging").index()}).on("dragend.h5s",function(){b&&(b.removeClass("sortable-dragging").show(),c.detach(),h!=b.index()&&b.parent().trigger("sortupdate",{item:b}),b=null)}).not("a[href], img").on("selectstart.h5s",function(){return this.dragDrop&&this.dragDrop(),!1}).end().add([this,i]).on("dragover.h5s dragenter.h5s drop.h5s",function(e){return f.is(b)||d.connectWith===a(b).parent().data("connectWith")?"drop"==e.type?(e.stopPropagation(),c.filter(":visible").after(b),b.trigger("dragend.h5s"),!1):(e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="move",f.is(this)?(d.forcePlaceholderSize&&i.height(b.outerHeight()),b.hide(),a(this)[i.index()<a(this).index()?"after":"before"](i),c.not(i).detach()):c.is(this)||a(this).children(d.items).length||(c.detach(),a(this).append(i)),!1):!0})})}}(jQuery),function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.GridList=b()}(this,function(){var a=function(a,b){this.options=b;for(var c in this.defaults)this.options.hasOwnProperty(c)||(this.options[c]=this.defaults[c]);this.items=a,this._adjustHeightOfItems(),this.generateGrid()};a.cloneItems=function(a,b){var c,d;for(void 0===b&&(b=[]),c=0;c<a.length;c++){b[c]||(b[c]={});for(d in a[c])b[c][d]=a[c][d]}return b},a.prototype={defaults:{rows:5},generateGrid:function(){var a;for(this._resetGrid(),a=0;a<this.items.length;a++)this._markItemPositionToGrid(this.items[a])},resizeGrid:function(a){var b,c,d=0;for(this.options.rows=a,this._adjustHeightOfItems(),this._sortItemsByPosition(),this._resetGrid(),c=0;c<this.items.length;c++)b=this.items[c],this._updateItemPosition(b,this.findPositionForItem(b,{x:d,y:0})),d=Math.max(d,b.x)},findPositionForItem:function(a,b,c){var d,e,f;for(d=b.x;d<this.grid.length;d++)if(void 0!==c){if(f=[d,c],this._itemFitsAtPosition(a,f))return f}else for(e=b.y;e<this.options.rows;e++)if(f=[d,e],this._itemFitsAtPosition(a,f))return f;return[this.grid.length,c||0]},moveItemToPosition:function(a,b){this._updateItemPosition(a,b),this._resolveCollisions(a)},resizeItem:function(a,b){this._updateItemSize(a,b),this._resolveCollisions(a)},getChangedItems:function(a,b){var c,d,e=[];for(c=0;c<a.length;c++)d=this._getItemByAttribute(b,a[c][b]),(d.x!==a[c].x||d.y!==a[c].y||d.w!==a[c].w||d.h!==a[c].h)&&e.push(d);return e},_sortItemsByPosition:function(){this.items.sort(function(a,b){return a.x!=b.x?a.x-b.x:a.y!=b.y?a.y-b.y:0})},_adjustHeightOfItems:function(){var a,b;for(b=0;b<this.items.length;b++)a=this.items[b],void 0===a.autoHeight&&(a.autoHeight=!a.h),a.autoHeight&&(a.h=this.options.rows)},_resetGrid:function(){this.grid=[]},_itemFitsAtPosition:function(a,b){var c,d;if(b[0]<0||b[1]<0)return!1;if(b[1]+a.h>this.options.rows)return!1;for(c=b[0];c<b[0]+a.w;c++)if(col=this.grid[c])for(d=b[1];d<b[1]+a.h;d++)if(col[d]&&col[d]!=a)return!1;return!0},_updateItemPosition:function(a,b){null!==a.x&&null!==a.y&&this._deleteItemPositionFromGrid(a),a.x=b[0],a.y=b[1],this._markItemPositionToGrid(a)},_updateItemSize:function(a,b){null!==a.x&&null!==a.y&&this._deleteItemPositionFromGrid(a),a.w=b,this._markItemPositionToGrid(a)},_markItemPositionToGrid:function(a){var b,c;for(this._ensureColumns(a.x+a.w),b=a.x;b<a.x+a.w;b++)for(c=a.y;c<a.y+a.h;c++)this.grid[b][c]=a},_deleteItemPositionFromGrid:function(a){var b,c;for(b=a.x;b<a.x+a.w;b++)if(this.grid[b])for(c=a.y;c<a.y+a.h;c++)this.grid[b][c]==a&&(this.grid[b][c]=null)},_ensureColumns:function(a){var c;for(c=0;a>c;c++)this.grid[c]||this.grid.push(new b(this.options.rows))},_getItemsCollidingWithItem:function(a){for(var b=[],c=0;c<this.items.length;c++)a!=this.items[c]&&this._itemsAreColliding(a,this.items[c])&&b.push(c);return b},_itemsAreColliding:function(a,b){return!(b.x>=a.x+a.w||b.x+b.w<=a.x||b.y>=a.y+a.h||b.y+b.h<=a.y)},_resolveCollisions:function(a){this._tryToResolveCollisionsLocally(a)||this._pullItemsToLeft(a),this._pullItemsToLeft()},_tryToResolveCollisionsLocally:function(b){var c=this._getItemsCollidingWithItem(b);if(!c.length)return!0;var d,e,f,g,h,i,j=new a([],this.options);for(a.cloneItems(this.items,j.items),j.generateGrid(),e=0;e<c.length;e++)if(d=j.items[c[e]],f=[b.x-d.w,d.y],g=[b.x+b.w,d.y],h=[d.x,b.y-d.h],i=[d.x,b.y+b.h],j._itemFitsAtPosition(d,f))j._updateItemPosition(d,f);else if(j._itemFitsAtPosition(d,h))j._updateItemPosition(d,h);else if(j._itemFitsAtPosition(d,i))j._updateItemPosition(d,i);else{if(!j._itemFitsAtPosition(d,g))return!1;j._updateItemPosition(d,g)}return a.cloneItems(j.items,this.items),this.generateGrid(),!0},_pullItemsToLeft:function(a){var b,c;for(this._sortItemsByPosition(),this._resetGrid(),a&&this._updateItemPosition(a,[a.x,a.y]),c=0;c<this.items.length;c++)b=this.items[c],a&&b==a||this._updateItemPosition(b,this.findPositionForItem(b,{x:this._findLeftMostPositionForItem(b),y:0},b.y))},_findLeftMostPositionForItem:function(a){var b,c,d=0;for(c=0;c<this.grid.length;c++)b=this.grid[c][a.y],b&&this.items.indexOf(b)<this.items.indexOf(a)&&(d=b.x+b.w);return d},_getItemByAttribute:function(a,b){for(var c=0;c<this.items.length;c++)if(this.items[c][a]===b)return this.items[c];return null}};var b=function(a){for(var b=0;a>b;b++)this.push(null)};return b.prototype=[],a}),function(a){"function"==typeof define&&define.amd?define(["jquery","gridlist"],a):a(jQuery,GridList)}(function(a,b){var c=function(b,c){this.options=a.extend({},this.defaults,c),this.$element=a(b),this._init(),this._bindEvents()};c.prototype={defaults:{rows:5,widthHeightRatio:1,dragAndDrop:!0},destroy:function(){this._unbindEvents()},resize:function(a){a&&(this.options.rows=a),this._createGridSnapshot(),this.gridList.resizeGrid(this.options.rows),this._updateGridSnapshot(),this.reflow()},resizeItem:function(a,b){this._createGridSnapshot(),this.gridList.resizeItem(this._getItemByElement(a),b),this._updateGridSnapshot(),this.render()},reflow:function(){this._calculateCellSize(),this.render()},render:function(){this._applySizeToItems(),this._applyPositionToItems()},_bindMethod:function(a){var b=this;return function(){return a.apply(b,arguments)}},_init:function(){this.$items=this.$element.children("li[data-w]"),this.items=this._generateItemsFromDOM(),this.$positionHighlight=this.$element.find(".position-highlight").hide(),this._initGridList(),this.reflow(),this.options.dragAndDrop&&this.$items.draggable({zIndex:this.items.length,scroll:!1})},_initGridList:function(){this.gridList=new b(this.items,{rows:this.options.rows})},_bindEvents:function(){this._onStart=this._bindMethod(this._onStart),this._onDrag=this._bindMethod(this._onDrag),this._onStop=this._bindMethod(this._onStop),this.$items.on("dragstart",this._onStart),this.$items.on("drag",this._onDrag),this.$items.on("dragstop",this._onStop)},_unbindEvents:function(){this.$items.off("dragstart",this._onStart),this.$items.off("drag",this._onDrag),this.$items.off("dragstop",this._onStop)},_onStart:function(){this._createGridSnapshot(),this._maxGridCols=this.gridList.grid.length},_onDrag:function(a,c){var d=this._getItemByElement(c.helper),e=this._snapItemPositionToGrid(d);this._dragPositionChanged(e)&&(this._previousDragPosition=e,b.cloneItems(this._items,this.items),this.gridList.generateGrid(),d=this._getItemByElement(c.helper),this.gridList.moveItemToPosition(d,e),this._applyPositionToItems(),this._highlightPositionForItem(d))},_onStop:function(b,c){this._updateGridSnapshot(),this._previousDragPosition=null,a(c.helper).removeClass("ui-draggable-dragging"),this._applyPositionToItems(),this._removePositionHighlight()},_generateItemsFromDOM:function(){var b=[];return this.$items.each(function(c,d){b.push({$element:a(d),x:Number(a(d).attr("data-x")),y:Number(a(d).attr("data-y")),w:Number(a(d).attr("data-w")),h:Number(a(d).attr("data-h")),id:Number(a(d).attr("data-id"))})}),b},_getItemByElement:function(a){for(var b=0;b<this.items.length;b++)if(this.items[b].$element.is(a))return this.items[b]},_calculateCellSize:function(){this._cellHeight=Math.floor(this.$element.height()/this.options.rows),this._cellWidth=this._cellHeight*this.options.widthHeightRatio,this.options.heightToFontSizeRatio&&(this._fontSize=this._cellHeight*this.options.heightToFontSizeRatio)},_getItemWidth:function(a){return a.w*this._cellWidth},_getItemHeight:function(a){return a.h*this._cellHeight},_applySizeToItems:function(){for(var a=0;a<this.items.length;a++)this.items[a].$element.css({width:this._getItemWidth(this.items[a]),height:this._getItemHeight(this.items[a])});this.options.heightToFontSizeRatio&&this.$items.css("font-size",this._fontSize)},_applyPositionToItems:function(){for(var a=0;a<this.items.length;a++)this.items[a].move||this.items[a].$element.css({left:this.items[a].x*this._cellWidth,top:this.items[a].y*this._cellHeight});this.$element.width((this.gridList.grid.length+1)*this._cellWidth)},_dragPositionChanged:function(a){return this._previousDragPosition?a[0]!=this._previousDragPosition[0]||a[1]!=this._previousDragPosition[1]:!0},_snapItemPositionToGrid:function(a){var b,c,d=a.$element.position();return d[0]-=this.$element.position().left,c=Math.round(d.left/this._cellWidth),b=Math.round(d.top/this._cellHeight),c=Math.max(c,0),b=Math.max(b,0),c=Math.min(c,this._maxGridCols),b=Math.min(b,this.options.rows-a.h),[c,b]},_highlightPositionForItem:function(a){this.$positionHighlight.css({width:this._getItemWidth(a),height:this._getItemHeight(a),left:a.x*this._cellWidth,top:a.y*this._cellHeight}).show(),this.options.heightToFontSizeRatio&&this.$positionHighlight.css("font-size",this._fontSize)},_removePositionHighlight:function(){this.$positionHighlight.hide()},_createGridSnapshot:function(){this._items=b.cloneItems(this.items)},_updateGridSnapshot:function(){this._triggerOnChange(),b.cloneItems(this.items,this._items)},_triggerOnChange:function(){"function"==typeof this.options.onChange&&this.options.onChange.call(this,this.gridList.getChangedItems(this._items,"$element"))}},a.fn.gridList=function(b){if(!window.GridList)throw new Error("GridList lib required");var d,e,f;return"string"==typeof b&&(e=b,f=Array.prototype.slice.call(arguments,1)),this.each(function(){d=a(this).data("_gridList"),d&&!e&&(d.destroy(),d=null),d||(d=new c(this,b),a(this).data("_gridList",d)),e&&d[e].apply(d,f)}),this}}),function(a){a(document).ready(function(){a('div[data-appui="editable"]').on({mouseenter:function(){a(this).find(".contentpanel-editbar").removeClass("fadeOutUp").addClass("fadeInLeft").show()},mouseleave:function(){a(this).find(".contentpanel-editbar").removeClass("fadeInLeft").addClass("fadeOutUp")}});var b=a(".ppe-section-sortable").sortable({items:".ppe-block-sortable",handle:".ppe-dragindicator"});b.length&&b.on("sortupdate",function(){var c=b.data("appui-ajax-uri"),d=a("#ppe-form-rearrange").serializeArray();a.ajax({url:c,data:d,context:document.body,success:function(b){if(b.success===!0){var c=b.message,d='<p class="text-warning">'+c+"</p>";a("#ppe-statusinfo-content").append(d).removeClass("hidden").slideDown("slow")}else console.log("Form could not be submitted. Bummer.")}})})})}(jQuery);